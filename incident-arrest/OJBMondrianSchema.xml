<!--
    
    Unless explicitly acquired and licensed from Licensor under another license, the contents of
    this file are subject to the Reciprocal Public License ("RPL") Version 1.5, or subsequent
    versions as allowed by the RPL, and You may not copy or use this file in either source code
    or executable form, except in compliance with the terms and conditions of the RPL
    All software distributed under the RPL is provided strictly on an "AS IS" basis, WITHOUT
    WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, AND LICENSOR HEREBY DISCLAIMS ALL SUCH
    WARRANTIES, INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
    PARTICULAR PURPOSE, QUIET ENJOYMENT, OR NON-INFRINGEMENT. See the RPL for specific language
    governing rights and limitations under the RPL.

    http://opensource.org/licenses/RPL-1.5

    Copyright 2012-2015 Open Justice Broker Consortium

    -->
<Schema name="Incident_Arrest" metamodelVersion='4.0'  xsi:noNamespaceSchemaLocation="mondrian4.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

	<PhysicalSchema>
		<Table name="County"/>
		<Table name="ReportingSystem"/>
		<Table name="Region"/>
		<Table name="Town"/>
		<Table name="Agency"/>
		<Table name="PersonRace"/>
		<Table name="InvolvedDrug"/>
		<Table name="OffenseType"/>
		<Table name="PersonSex"/>
		<Table name="Disposition">
			<ColumnDefs>
				<CalculatedColumnDef name='ConvictionStatusDescription' type='String'>
	                <ExpressionView>
	                    <SQL dialect='mysql'> 
	                        IF(<Column name="IsConviction"/>='Y',"Convicted", "Not Convicted")
	                    </SQL>
	                </ExpressionView>
	            </CalculatedColumnDef>
        	</ColumnDefs>
		</Table>
		<Table name="PersonAge" keyColumn="PersonAgeID"/>
		<Table name="PersonAgeRange" keyColumn="PersonAgeRangeID"/>
		<Link source='PersonAgeRange' target='PersonAge'>
			<ForeignKey>
                <Column name='PersonAgeRangeID'/>
            </ForeignKey>
		</Link>
		<Table name="RiskScore"/>
		<Table name="AssessedNeed"/>
		<Table name="PretrialService"/>
		<Table name="YesNo"/>
		<Table name="DispositionOffenseType"/>
		<Table name="IncidentType2"/>
		<Table name="IncidentType" keyColumn="IncidentTypeID"/>
		<Table name="IncidentCategory" keyColumn="IncidentCategoryID"/>
		<Link source='IncidentCategory' target='IncidentType'>
			<ForeignKey>
                <Column name='IncidentCategoryID'/>
            </ForeignKey>
		</Link>
		<Table name="Time"/>
		<Table name="Date"/>
       	<Table name="Population"/>
       	<Table name="Incident"/>
       	<Table name="IncidentOptHour"/>
      	<Table name="IncidentOptHourType"/>
      	<Table name="IncidentOptHourType2"/>
      	<Table name="ReadyCashOffenseCategory"/>
		<Query alias="Year">
			<ExpressionView>
				<SQL dialect="generic">
	            <![CDATA[select distinct Year as YearID, Year as YearLabel from Date]]>
	            </SQL>
			</ExpressionView>
		</Query>
		<Query alias="ReadyCashOffenseType">
		    <ExpressionView>
			    <SQL dialect="generic">
			        <![CDATA[select OffenseTypeID, OffenseDescription, ReadyCashOffenseCategoryDescription from OffenseType, ReadyCashOffenseCategory
                    where OffenseType.ReadyCashOffenseCategoryID=ReadyCashOffenseCategory.ReadyCashOffenseCategoryID]]>
                </SQL>
            </ExpressionView>
        </Query>
        <Query alias="IncidentTypeWithCategory">
            <ExpressionView>
			    <SQL dialect="generic">
			        <![CDATA[select IncidentTypeID, IncidentTypeDescription, IncidentCategoryDescription from IncidentType, IncidentCategory
                    where IncidentType.IncidentCategoryID=IncidentCategory.IncidentCategoryID]]>
                </SQL>
            </ExpressionView>
		</Query>
		<Query alias="CrimeCount">
			<ExpressionView >
				<SQL dialect="mysql">
        			<![CDATA[select count(Charge.ArrestID) as ArrestCount, ArresteeRaceID, ArresteeSexID, PersonAgeRange.PersonAgeRangeID, CountyID, ArrestOffenseTypeID, Year, InvolvedDrugID
            		from Arrest, PersonAge, PersonAgeRange, Charge, Date
            		where Arrest.ArresteeAgeID=PersonAge.PersonAgeID and PersonAge.PersonAgeRangeID=PersonAgeRange.PersonAgeRangeID and Arrest.ArrestID=Charge.ArrestID
                		and Arrest.DateID=Date.DateID
            		group by ArresteeRaceID, ArresteeSexID, PersonAgeRange.PersonAgeRangeID, CountyID, ArrestOffenseTypeID, Year]]>
            	</SQL>
			</ExpressionView>
		</Query>
		<Query alias="ArrestChargeRecidivism">
			<ExpressionView>
				<SQL dialect="mysql">
					<![CDATA[
					select a.ArrestID,
					a.DateID,
					a.TimeID,
					a.CountyID,
					County.RegionID,
					ArresteeAgeID,
					ArresteeSexID,
					ArresteeRaceID,
					ArrestingAgencyID,
					if(PretrialServiceEligible=1, 1, 0) as PretrialServiceEligible,
					DaysUntilNextArrest,
					if(SixMonthRearrestIndicator=1, 1, 0) as SixMonthRearrest,
					if(OneYearRearrestIndicator=1, 1, 0) as OneYearRearrest,
					if(TwoYearRearrestIndicator=1, 1, 0) as TwoYearRearrest,
					if(OneYearReconvictionIndicator=1, 1, 0) as OneYearReconviction,
					if(TwoYearReconvictionIndicator=1, 1, 0) as TwoYearReconviction,
					ChargeID,
					ArrestOffenseTypeID,
					DispositionID,
					SentenceTermDays,
					SentenceFineAmount,
					InvolvedDrugID,
					DispositionDateID,
					DispositionOffenseTypeID,
					FiledOffenseTypeID,
					if(psp.PretrialServiceParticipationID is null, 2, 1) as PretrialServicesParticipantIndicator,
					psp.RiskScoreID
					from ((Arrest as a inner join Date as ad on a.DateID=ad.DateID) inner join
					(Charge as c left join Date as cd on c.DispositionDateID=cd.DateID) on a.ArrestID=c.ArrestID) left join
					PretrialServiceParticipation as psp on a.ArrestID=psp.ArrestID inner join County on a.CountyID=County.CountyID]]>
				</SQL>
			</ExpressionView>
		</Query>
		<Query alias="IncidentTypeInvolvement">
			<ExpressionView>
		    	<SQL dialect="generic">
        			<![CDATA[ select Incident.IncidentID, TownID, ReportingAgencyID, IncidentTypeID, DateID, TimeID
                    from Incident, IncidentTypeAssociation where Incident.IncidentID=IncidentTypeAssociation.IncidentID]]>
				</SQL>
			</ExpressionView>
		</Query>
		<Query alias="IncidentType2Involvement">
			<ExpressionView>
		    	<SQL dialect="mysql">
        			<![CDATA[ select Incident.IncidentID, TownID, ReportingAgencyID, IncidentTypeID, DateID, TimeID
                    from Incident, IncidentType2Association where Incident.IncidentID=IncidentType2Association.IncidentID]]>
				</SQL>
			</ExpressionView>
		</Query>
		<Query alias="PretrialServicesParticipation">
			<ExpressionView>
				<SQL dialect="generic">
					<![CDATA[select PretrialServiceParticipationID, ArresteeRaceID, PreChargeMonitoringIndicator,
					ArresteeSexID, ArresteeAgeID, PretrialServiceParticipation.CountyID, IntakeDateID, RiskScoreID, RegionID
					from PretrialServiceParticipation, Arrest, County
					where PretrialServiceParticipation.ArrestID=Arrest.ArrestID and County.CountyID=PretrialServiceParticipation.CountyID]]>
				</SQL>
			</ExpressionView>
		</Query>
		<Query alias="PretrialServicesNeedsAssessment">
			<ExpressionView>
				<SQL dialect="mysql">
			        <![CDATA[select PretrialServiceParticipation.PretrialServiceParticipationID, ArresteeRaceID,
			        ArresteeSexID, ArresteeAgeID, PretrialServiceParticipation.CountyID, IntakeDateID, PretrialAssessedNeed.AssessedNeedID, RiskScoreID, RegionID
			        from PretrialServiceParticipation, Arrest, AssessedNeed, PretrialAssessedNeed, County
			        where PretrialServiceParticipation.ArrestID=Arrest.ArrestID and PretrialServiceParticipation.PretrialServiceParticipationID=PretrialAssessedNeed.PretrialServiceParticipationID and
			        PretrialAssessedNeed.AssessedNeedID=AssessedNeed.AssessedNeedID and County.CountyID=PretrialServiceParticipation.CountyID]]>
				</SQL>
			</ExpressionView>
		</Query>
		<Query alias="PretrialServicesUtilized">
			<ExpressionView>
				<SQL dialect="mysql">
				<![CDATA[select PretrialServiceParticipation.PretrialServiceParticipationID, ArresteeRaceID,
				ArresteeSexID, ArresteeAgeID, PretrialServiceParticipation.CountyID, IntakeDateID, PretrialServiceAssociation.PretrialServiceID, RiskScoreID, RegionID
				from PretrialServiceParticipation, Arrest, PretrialService, PretrialServiceAssociation, County
				where PretrialServiceParticipation.ArrestID=Arrest.ArrestID and PretrialServiceParticipation.PretrialServiceParticipationID=PretrialServiceAssociation.PretrialServiceParticipationID and
				PretrialServiceAssociation.PretrialServiceID=PretrialService.PretrialServiceID and County.CountyID=PretrialServiceParticipation.CountyID]]>
				</SQL>
			</ExpressionView>
		</Query>
    </PhysicalSchema>

	<Dimension name='County' table='County' key='CountyID'>
        <Attributes>
            <Attribute name='CountyID' keyColumn='CountyID' hasHierarchy='false'/>
            <Attribute name='CountyName' keyColumn='CountyName' hasHierarchy='false' caption="County Name"/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Counties' allMemberName='All Counties'>
                <Level attribute='CountyName'/>
            </Hierarchy>
        </Hierarchies>
    </Dimension>

    <Dimension name="Reporting System" table="ReportingSystem" key="ReportingSystemID">
        <Attributes>
            <Attribute name='ReportingSystemID' keyColumn='ReportingSystemID' hasHierarchy='false'/>
            <Attribute name='ReportingSystemDescription' keyColumn='ReportingSystemDescription' hasHierarchy='false'/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Reporting System' allMemberName='All Systems'>
                <Level attribute='ReportingSystemDescription'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Region" table="Region" key="RegionID">
        <Attributes>
            <Attribute name='RegionID' keyColumn='RegionID' hasHierarchy='false'/>
            <Attribute name='RegionDescription' keyColumn='RegionDescription' hasHierarchy='false'/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Region' allMemberName='All Regions'>
                <Level attribute='RegionDescription'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Town" table="Town" key="TownID">
        <Attributes>
            <Attribute name='TownID' keyColumn='TownID' hasHierarchy='false'/>
            <Attribute name='TownDescription' keyColumn='TownDescription' hasHierarchy='false'/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Town' allMemberName='All Towns'>
                <Level attribute='TownDescription'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Agency" table="Agency" key="AgencyID">
        <Attributes>
            <Attribute name='AgencyID' keyColumn='AgencyID' hasHierarchy='false'/>
            <Attribute name='AgencyName' keyColumn='AgencyName' hasHierarchy='false'/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Agency' allMemberName='All Agencies'>
                <Level attribute='AgencyName'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Race" table="PersonRace" key="PersonRaceID">
        <Attributes>
            <Attribute name='PersonRaceID' keyColumn='PersonRaceID' hasHierarchy='false'/>
            <Attribute name='PersonRaceDescription' keyColumn='PersonRaceDescription' hasHierarchy='false' caption="Person Race"/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Race' allMemberName='All Races'>
                <Level attribute='PersonRaceDescription'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Drug" table="InvolvedDrug" key="InvolvedDrugID">
        <Attributes>
            <Attribute name='InvolvedDrugID' keyColumn='InvolvedDrugID' hasHierarchy='false'/>
            <Attribute name='InvolvedDrugDescription' keyColumn='InvolvedDrugDescription' hasHierarchy='false'/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Drug' allMemberName='All Drugs'>
                <Level attribute='InvolvedDrugDescription'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Year" table="Year" key="YearID">
        <Attributes>
            <Attribute name='YearID' keyColumn='YearID' hasHierarchy='false'/>
            <Attribute name='YearLabel' keyColumn='YearLabel' hasHierarchy='false'/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Year' allMemberName='All Years'>
                <Level attribute='YearLabel'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension type="TIME" name="Date" table="Date" key="DateID">
        <Attributes>
            <Attribute name='DateID' keyColumn='DateID' hasHierarchy='false'/>
            <Attribute name='Year' keyColumn='YearLabel' hasHierarchy='false' levelType="TimeYears"/>
            <Attribute name='Quarter' hasHierarchy='false' levelType="TimeQuarters">
            	<Key>
                    <Column name='YearLabel'/>
                    <Column name='CalendarQuarter'/>
                </Key>
                <Name>
                    <Column name='CalendarQuarter'/>
                </Name>
            </Attribute>
            <Attribute name='Month' hasHierarchy='false' levelType="TimeMonths">
            	<Key>
                    <Column name='YearLabel'/>
                    <Column name='CalendarQuarter'/>
                    <Column name='Month'/>
                </Key>
                <Name>
                    <Column name='Month'/>
                </Name>
            </Attribute>
            <Attribute name='Day' hasHierarchy='false' levelType="TimeDays">
            	<Key>
                    <Column name='YearLabel'/>
                    <Column name='CalendarQuarter'/>
                    <Column name='Month'/>
                    <Column name='Day'/>
                </Key>
                <Name>
                    <Column name='Day'/>
                </Name>
            </Attribute>
            <Attribute name='Date' keyColumn='CalendarDate' hasHierarchy='false' levelType="TimeDays"/>            
            <Attribute name='Day of Week' keyColumn='DayOfWeek' hasHierarchy='false' levelType="TimeDays"/>  
        </Attributes>
        <Hierarchies>
            <Hierarchy name='DateYMD' caption="Year/Month/Day" allMemberName="All Years" allMemberCaption="All Years">
 				<Level attribute='Year' />
                <Level attribute='Quarter' />
                <Level attribute='Month' />
                <Level attribute='Day' />
            </Hierarchy>
            <Hierarchy name='CalDate' caption="Calendar Date" allMemberName="All Dates" allMemberCaption="All Dates">
                <Level attribute='Date'/>
            </Hierarchy>
            <Hierarchy name='Day of Week' caption="Day of Week" allMemberName="All Days" allMemberCaption="All Days">
                <Level attribute='Day of Week'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Sex" table="PersonSex" key="PersonSexID">
        <Attributes>
            <Attribute name='PersonSexID' keyColumn='PersonSexID' hasHierarchy='false'/>
            <Attribute name='PersonSexDescription' keyColumn='PersonSexDescription' hasHierarchy='false' caption="Person Sex"/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Sex' allMemberName='All Sexes'>
                <Level attribute='PersonSexDescription'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Disposition" table="Disposition" key="DispositionID">
        <Attributes>
            <Attribute name='DispositionID' keyColumn='DispositionID' hasHierarchy='false'/>
            <Attribute name='ConvictionStatusDescription' keyColumn='ConvictionStatusDescription' hasHierarchy='false' caption="Convicted?"/>
            <Attribute name='DispositionDescription' keyColumn='DispositionDescription' hasHierarchy='false' caption="Disposition"/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Disposition' allMemberName='All Dispositions'>
                <Level attribute='ConvictionStatusDescription'/>
                <Level attribute='DispositionDescription' parentAttribute="ConvictionStatusDescription"/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Age" key="PersonAgeID">
        <Attributes>
            <Attribute table="PersonAge" name='PersonAgeID' keyColumn='PersonAgeID' hasHierarchy='false'/>
            <Attribute name='AgeRange5' table='PersonAgeRange' keyColumn="AgeRange5" hasHierarchy='false'/>
            <Attribute table="PersonAge" name='AgeInYears' hasHierarchy='false'>
                <Key>
                    <Column table='PersonAgeRange' name='AgeRange5'/>
                    <Column name='AgeInYears'/>
                </Key>
                <Name>
                    <Column name='AgeInYears'/>
                </Name>
            </Attribute>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Age' allMemberName='All Ages'>
                <Level attribute='AgeRange5' caption="Age Range"/>
                <Level attribute='AgeInYears' parentAttribute="AgeRange5" caption="Age"/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>
	
	<Dimension name="Age Range" table="PersonAgeRange" key="PersonAgeRangeID">
		<Attributes>
			<Attribute keyColumn="PersonAgeRangeID" hasHierarchy='false' name="PersonAgeRangeID"/>
			<Attribute keyColumn="AgeRange5" hasHierarchy='false' name="PersonAgeRange"/>
		</Attributes>
		<Hierarchies>
            <Hierarchy name='Age Range' allMemberName='All Age Ranges'>
                <Level attribute='PersonAgeRange' caption="Age Range"/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Risk Score" table="RiskScore" key="RiskScoreID">
        <Attributes>
            <Attribute name='RiskScoreID' keyColumn='RiskScoreID' hasHierarchy='false'/>
            <Attribute name='RiskScoreDescription' keyColumn='RiskScoreDescription' hasHierarchy='false'/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='RiskScore' allMemberName='All Risk Scores'>
                <Level attribute='RiskScoreDescription'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Assessed Need" table="AssessedNeed" key="AssessedNeedID">
        <Attributes>
            <Attribute name='AssessedNeedID' keyColumn='AssessedNeedID' hasHierarchy='false'/>
            <Attribute name='AssessedNeedDescription' keyColumn='AssessedNeedDescription' hasHierarchy='false'/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='AssessedNeed' allMemberName='All Assessed Needs'>
                <Level attribute='AssessedNeedDescription'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Pretrial Service" table="PretrialService" key="PretrialServiceID">
        <Attributes>
            <Attribute name='PretrialServiceID' keyColumn='PretrialServiceID' hasHierarchy='false'/>
            <Attribute name='Pretrial Service Participant' keyColumn='IsParticipant' hasHierarchy='false' caption="Participant?"/>
            <Attribute name='PretrialServiceDescription' keyColumn='PretrialServiceDescription' hasHierarchy='false' caption="Pretrial Service"/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='PretrialService' allMemberName='All Pretrial Services'>
                <Level attribute='Pretrial Service Participant'/>
                <Level attribute='PretrialServiceDescription' parentAttribute="Pretrial Service Participant"/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="YesNoIndicator" table="YesNo" key="YesNoID">
        <Attributes>
            <Attribute name='YesNoID' keyColumn='YesNoID' hasHierarchy='false'/>
            <Attribute name='YesNoDescription' keyColumn='YesNoDescription' hasHierarchy='false'/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='YesNoIndicator' allMemberName='All Options'>
                <Level attribute='YesNoDescription' caption="Yes/No?"/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Offense Type" table='OffenseType' key="OffenseTypeID">
        <Attributes>
            <Attribute name='OffenseTypeID'  keyColumn='OffenseTypeID'  hasHierarchy='false'/>
            <Attribute name='OffenseDescription'  keyColumn='OffenseDescription' hasHierarchy='false'/>
            <Attribute name='IsDrugOffense' keyColumn='IsDrugOffense' hasHierarchy='false'/>
            <Attribute name='OffenseSeverity' keyColumn='OffenseSeverity'  hasHierarchy='false'/>
            <Attribute name='ReadyCashOffenseCategoryDescription' keyColumn='ReadyCashOffenseCategoryID' hasHierarchy='false'/>
        </Attributes>
          <Hierarchies>
	        <Hierarchy name="OffenseType" allMemberName="All Offenses" caption="Offense Type">
	        	<Level attribute='OffenseDescription' caption='Type of Offense'/>
	        </Hierarchy>
	        <Hierarchy name="Drug Offense" allMemberName="All Offenses" caption="Drug Offense">
	            <Level attribute="IsDrugOffense" caption="Is Drug Offense"/>
	            <Level attribute="OffenseDescription" caption="Type of Offense"/>
	        </Hierarchy>
	        <Hierarchy name="Offense Severity" allMemberName="All Severities" caption="Offense Severity">
	            <Level attribute="OffenseSeverity" caption="Severity of Offense"/>
	            <Level attribute="OffenseDescription" caption="Type of Offense"/>
	        </Hierarchy>
	        <Hierarchy name="Ready Cash Offenses" caption="Ready Cash Offenses">
	            <Level attribute="ReadyCashOffenseCategoryDescription" caption="Ready Cash Offense Category"/>
	            <Level attribute="OffenseDescription" caption="Type of Offense"/>
	        </Hierarchy>
	       </Hierarchies>
	</Dimension>


	<Dimension name="Disposition Offense Type" table="DispositionOffenseType" key="DispositionOffenseTypeID">
        <Attributes>
            <Attribute name='DispositionOffenseTypeID' keyColumn='DispositionOffenseTypeID' hasHierarchy='false'/>
            <Attribute name='DispositionOffenseTypeDescription' keyColumn='DispositionOffenseTypeDescription' hasHierarchy='false'/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Disposition Offense Type' allMemberName='All Offense Types'>
                <Level attribute='DispositionOffenseTypeDescription'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Original Incident Type" table="IncidentType2" key="IncidentTypeID">
        <Attributes>
            <Attribute name='IncidentTypeID' keyColumn='IncidentTypeID' hasHierarchy='false'/>
            <Attribute name='IncidentTypeDescription' keyColumn='IncidentTypeDescription' hasHierarchy='false' caption="Incident Type"/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Original Incident Type' allMemberName='All Incident Types'>
                <Level attribute='IncidentTypeDescription'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Time Of Day" table="Time" key="TimeID">
        <Attributes>
            <Attribute name='TimeID' keyColumn='TimeID' hasHierarchy='false'/>
            <Attribute name='Hour' keyColumn='Hour' hasHierarchy='false'/>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Time Of Day' allMemberName='All Hours'>
                <Level attribute='Hour'/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Dimension name="Incident Type" key="IncidentTypeID">
        <Attributes>
            <Attribute table="IncidentType" name='IncidentTypeID' keyColumn='IncidentTypeID' hasHierarchy='false'/>
            <Attribute table='IncidentCategory' name='IncidentCategoryDescription'  keyColumn="IncidentCategoryDescription" hasHierarchy='false'/>
            <Attribute table="IncidentType" name='IncidentTypeDescription' hasHierarchy='false'>
                <Key>
                    <Column table='IncidentCategory' name='IncidentCategoryDescription'/>
                    <Column name='IncidentTypeDescription'/>
                </Key>
                <Name>
                    <Column name='IncidentTypeDescription'/>
                </Name>
            </Attribute>
        </Attributes>
        <Hierarchies>
            <Hierarchy name='Incident Type' allMemberName='All Incident Types'>
                <Level attribute='IncidentCategoryDescription' caption="Incident Category"/>
                <Level attribute='IncidentTypeID' parentAttribute="IncidentCategoryDescription" caption="Incident Type"/>
            </Hierarchy>
        </Hierarchies>
	</Dimension>

	<Cube name="ArrestCharge" caption="Arrest Charge" visible="true" enabled="true">
		<Dimensions>
			<Dimension source="County"/>
			<Dimension source="Race"/>
			<Dimension source="Sex"/>
			<Dimension source="Age"/>
			<Dimension source="Date"/>
			<Dimension source="Date" name="Disposition Date"/>
			<Dimension source="Region" name="Pretrial District"/>
			<Dimension source="Agency" name="Agency"/>
			<Dimension source="Drug" name="Drug"/>
			<Dimension source="Offense Type" name="Offense Type"/>
			<Dimension source="Disposition Offense Type"/>
			<Dimension source="Disposition Offense Type" name="Filed Offense Type"/>
			<Dimension source="Disposition" name="Disposition"/>
			<Dimension source="Risk Score" name="Risk Score"/>
			<Dimension source="Time Of Day" name="Time Of Day"/>
			<Dimension source="YesNoIndicator" name="Pretrial Services Participant"/>
		</Dimensions>
		
        <MeasureGroups>
            <MeasureGroup table='ArrestChargeRecidivism'>
                <Measures>
                    <Measure name='ArrestChargeCount' column='ChargeID' aggregator='distinct-count' caption="Arrest Charge Count" datatype="Integer"/>
                	<Measure name="SixMonthRearrestCount" column="SixMonthRearrest" datatype="Integer" aggregator="sum" caption="Six Month Rearrest Count" visible="true"/>
                	<Measure name="OneYearRearrestCount" column="OneYearRearrest" datatype="Integer" aggregator="sum" caption="One Year Rearrest Count" visible="true"/>
					<Measure name="TwoYearRearrestCount" column="TwoYearRearrest" datatype="Integer" aggregator="sum" caption="Two Year Rearrest Count" visible="true"/>
					<Measure name="OneYearReconvictionCount" column="OneYearReconviction" datatype="Integer" aggregator="sum" caption="One Year Reconviction Count" visible="true"/>
					<Measure name="TwoYearReconvictionCount" column="TwoYearReconviction" datatype="Integer" aggregator="sum" caption="Two Year Reconviction Count" visible="true"/>
					<Measure name="PretrialServiceEligibleCount" column="PretrialServiceEligible" datatype="Integer" aggregator="sum" caption="Pretrial Service Eligible Count" visible="true"/>
					<Measure name="TotalSentenceTerm" column="SentenceTermDays" aggregator="avg" caption="Sentence Term (Days)" visible="true"/>
					<Measure name="TotalFineAmount" column="SentenceFineAmount" aggregator="avg" caption="Sentence Fine Amount" visible="true"/>
					<Measure name="DaysUntilSubsequentArrest" column="DaysUntilNextArrest" aggregator="distinct-count" caption="Days Until Next Arrest" visible="true"/>
                </Measures>
                <DimensionLinks>
                    <ForeignKeyLink dimension='County' foreignKeyColumn='CountyID'/>
					<ForeignKeyLink dimension='Sex' foreignKeyColumn='ArresteeSexID'/>
					<ForeignKeyLink dimension='Race' foreignKeyColumn='ArresteeRaceID'/>
					<ForeignKeyLink dimension='Age' foreignKeyColumn='ArresteeAgeID'/>
					<ForeignKeyLink dimension='Disposition' foreignKeyColumn='DispositionID'/>
					<ForeignKeyLink dimension='Date' foreignKeyColumn='DateID'/>
					<ForeignKeyLink dimension='Disposition Date' foreignKeyColumn='DispositionDateID'/>
					<ForeignKeyLink dimension="Pretrial District" foreignKeyColumn="RegionID"/>
					<ForeignKeyLink dimension="Agency" foreignKeyColumn="ArrestingAgencyID"/>
					<ForeignKeyLink dimension="Drug" foreignKeyColumn="InvolvedDrugID"/>
					<ForeignKeyLink dimension="Offense Type" foreignKeyColumn="ArrestOffenseTypeID"/>
					<ForeignKeyLink dimension="Disposition Offense Type" foreignKeyColumn="DispositionOffenseTypeID"/>
					<ForeignKeyLink dimension="Filed Offense Type" foreignKeyColumn="FiledOffenseTypeID"/>
					<ForeignKeyLink dimension="Risk Score" foreignKeyColumn="RiskScoreID"/>
					<ForeignKeyLink dimension="Time Of Day" foreignKeyColumn="TimeID"/>
					<ForeignKeyLink dimension="Pretrial Services Participant" foreignKeyColumn="PretrialServicesParticipantIndicator"/>
                </DimensionLinks>
            </MeasureGroup>
        </MeasureGroups>
		<CalculatedMembers>
			<CalculatedMember name="SixMonthRearrestRate"
				caption="Six Month Rearrest Rate" dimension="Measures">
				<Formula>[Measures].[SixMonthRearrestCount] /
					[Measures].[ArrestChargeCount]</Formula>
				<CalculatedMemberProperty name="FORMAT_STRING"
					value="#0.0 %" />
			</CalculatedMember>
			<CalculatedMember name="OneYearRearrestRate" caption="One Year Rearrest Rate"
				dimension="Measures">
				<Formula>[Measures].[OneYearRearrestCount] /
					[Measures].[ArrestChargeCount]</Formula>
				<CalculatedMemberProperty name="FORMAT_STRING"
					value="#0.0 %" />
			</CalculatedMember>
			<CalculatedMember name="TwoYearRearrestRate" caption="Two Year Rearrest Rate"
				dimension="Measures">
				<Formula>[Measures].[TwoYearRearrestCount] /
					[Measures].[ArrestChargeCount]</Formula>
				<CalculatedMemberProperty name="FORMAT_STRING"
					value="#0.0 %" />
			</CalculatedMember>
			<CalculatedMember name="OneYearReconvictionRate"
				caption="One Year Reconviction Rate" dimension="Measures">
				<Formula>[Measures].[OneYearReconvictionCount] /
					[Measures].[ArrestChargeCount]</Formula>
				<CalculatedMemberProperty name="FORMAT_STRING"
					value="#0.0 %" />
			</CalculatedMember>
			<CalculatedMember name="TwoYearReconvictionRate"
				caption="Two Year Reconviction Rate" dimension="Measures">
				<Formula>[Measures].[TwoYearReconvictionCount] /
					[Measures].[ArrestChargeCount]</Formula>
				<CalculatedMemberProperty name="FORMAT_STRING"
					value="#0.0 %" />
			</CalculatedMember>
			<CalculatedMember name="PretrialServiceEligiblePercent"
				caption="Pretrial Service Eligible Percent" dimension="Measures">
				<Formula>[Measures].[PretrialServiceEligibleCount] /
					[Measures].[ArrestChargeCount]</Formula>
				<CalculatedMemberProperty name="FORMAT_STRING"
					value="#0.0 %" />
			</CalculatedMember>
		</CalculatedMembers>
	</Cube>


    
	
	 <Cube name='Incident' >

        <Dimensions>
            <Dimension source='Town'/>
            <Dimension source='County'/>
            <Dimension source='Agency'/>
            <Dimension source='Date'/>
            <Dimension source='Time Of Day'/>
            <Dimension source='Reporting System'/>
        </Dimensions>

        <MeasureGroups>
            <MeasureGroup table='Incident'>
                <Measures>
                	<Measure name="IncidentCount" column="IncidentID" datatype="Integer" aggregator="distinct-count" caption="Incident Count" visible="true"/>     
                </Measures>
                <DimensionLinks>
                    <ForeignKeyLink dimension='Town' foreignKeyColumn='TownID'/>
                    <ForeignKeyLink dimension='County' foreignKeyColumn='CountyID'/>
                    <ForeignKeyLink dimension='Agency' foreignKeyColumn='ReportingAgencyID'/>
                    <ForeignKeyLink dimension='Date' foreignKeyColumn='DateID'/>
                    <ForeignKeyLink dimension='Time Of Day' foreignKeyColumn='TimeID'/>
                    <ForeignKeyLink dimension='Reporting System' foreignKeyColumn='ReportingSystemID'/>
                </DimensionLinks>
            </MeasureGroup>
        </MeasureGroups>

    </Cube>
    <Cube name='Incident_Optimized' caption='Incident Optimized' visible='false'>
   	 <Dimensions>
            <Dimension source='Town'/>
            <Dimension source='Agency'/>
            <Dimension source='Date'/>
            <Dimension source='Time Of Day'/>
        </Dimensions>

        <MeasureGroups>
            <MeasureGroup table='IncidentOptHour' name="Incident-Optimized">
                <Measures>
                	<Measure name="IncidentCount" column="IncidentCount" datatype="Integer" aggregator="sum" caption="Incident Count" visible="true"/>     
                </Measures>
                <DimensionLinks>
                    <ForeignKeyLink dimension='Town' foreignKeyColumn='TownID'/>
                    <ForeignKeyLink dimension='Agency' foreignKeyColumn='ReportingAgencyID'/>
                    <ForeignKeyLink dimension='Date' foreignKeyColumn='DateID'/>
                    <ForeignKeyLink dimension='Time Of Day' foreignKeyColumn='HourTimeID'/>
                </DimensionLinks>
            </MeasureGroup>
        </MeasureGroups>
    </Cube>
    <Cube name="IncidentTypeInvolvement" caption="Incident Type Involvement">
    	<Dimensions>
    		<Dimension source='Town'/>
    		<Dimension source='Agency'/>
    		<Dimension source='Incident Type'/>
    		<Dimension source='Date'/>
    		<Dimension source='Time Of Day'/>
    	</Dimensions>
    	<MeasureGroups>
    		<MeasureGroup table="IncidentTypeInvolvement">
	    		<Measures>
	    		    <Measure name="IncidentCount" column="IncidentID" datatype="Integer" aggregator="distinct-count" caption="Incident Count" visible="true"/>
	    		</Measures>
	    		 <DimensionLinks>
                    <ForeignKeyLink dimension='Town' foreignKeyColumn='TownID'/>
                    <ForeignKeyLink dimension='Agency' foreignKeyColumn='ReportingAgencyID'/>
                    <ForeignKeyLink dimension='Incident Type' foreignKeyColumn="IncidentTypeID"/>
                    <ForeignKeyLink dimension='Date' foreignKeyColumn='DateID'/>
                    <ForeignKeyLink dimension='Time Of Day' foreignKeyColumn='TimeID'/>
	             </DimensionLinks>
          </MeasureGroup>
    	</MeasureGroups>
    </Cube>
    
    <Cube name="IncidentTypeInvolvement_Optimized" caption="Incident Type Involvement Optimized" visible="false">
    	<Dimensions>
    		<Dimension source='Town'/>
    		<Dimension source='Agency'/>
    		<Dimension source='Incident Type'/>
    		<Dimension source='Date'/>
    		<Dimension source='Time Of Day'/>
    	</Dimensions>
    	<MeasureGroups>
    		<MeasureGroup table="IncidentOptHourType">
	    		<Measures>
	    		    <Measure name="IncidentCount" column="IncidentCount" datatype="Integer" aggregator="sum" caption="Incident Count" visible="true"/>
	    		</Measures>
	    		 <DimensionLinks>
                    <ForeignKeyLink dimension='Town' foreignKeyColumn='TownID'/>
                    <ForeignKeyLink dimension='Agency' foreignKeyColumn='ReportingAgencyID'/>
                    <ForeignKeyLink dimension='Incident Type' foreignKeyColumn="IncidentTypeID"/>
                    <ForeignKeyLink dimension='Date' foreignKeyColumn='DateID'/>
                    <ForeignKeyLink dimension='Time Of Day' foreignKeyColumn='HourTimeID'/>
	             </DimensionLinks>
          </MeasureGroup>
    	</MeasureGroups>
    </Cube>
    
     <Cube name="IncidentType2Involvement" caption="Original Incident Type Involvement">
    	<Dimensions>
    		<Dimension source='Town'/>
    		<Dimension source='Agency'/>
    		<Dimension source='Original Incident Type'/>
    		<Dimension source='Date'/>
    		<Dimension source='Time Of Day'/>
    	</Dimensions>
    	<MeasureGroups>
    		<MeasureGroup table="IncidentType2Involvement">
	    		<Measures>
	    		    <Measure name="IncidentCount" column="IncidentID" datatype="Integer" aggregator="distinct-count" caption="Incident Count" visible="true"/>
	    		</Measures>
	    		 <DimensionLinks>
                    <ForeignKeyLink dimension='Town' foreignKeyColumn='TownID'/>
                    <ForeignKeyLink dimension='Agency' foreignKeyColumn='ReportingAgencyID'/>
                    <ForeignKeyLink dimension='Original Incident Type' foreignKeyColumn="IncidentTypeID"/>
                    <ForeignKeyLink dimension='Date' foreignKeyColumn='DateID'/>
                    <ForeignKeyLink dimension='Time Of Day' foreignKeyColumn='TimeID'/>
	             </DimensionLinks>
          </MeasureGroup>
    	</MeasureGroups>
    </Cube>
    
    <Cube name="IncidentType2Involvement_Modified" caption="Original Incident Type Involvement Optimized" visible="false">
    	<Dimensions>
    		<Dimension source='Town'/>
    		<Dimension source='Agency'/>
    		<Dimension source='Original Incident Type'/>
    		<Dimension source='Date'/>
    		<Dimension source='Time Of Day'/>
    	</Dimensions>
    	<MeasureGroups>
    		<MeasureGroup table="IncidentOptHourType2">
	    		<Measures>
	    		    <Measure name="IncidentCount" column="IncidentCount" datatype="Integer" aggregator="sum" caption="Incident Count" visible="true"/>
	    		</Measures>
	    		 <DimensionLinks>
                    <ForeignKeyLink dimension='Town' foreignKeyColumn='TownID'/>
                    <ForeignKeyLink dimension='Agency' foreignKeyColumn='ReportingAgencyID'/>
                    <ForeignKeyLink dimension='Original Incident Type' foreignKeyColumn="IncidentTypeID"/>
                    <ForeignKeyLink dimension='Date' foreignKeyColumn='DateID'/>
                    <ForeignKeyLink dimension='Time Of Day' foreignKeyColumn='HourTimeID'/>
	             </DimensionLinks>
          </MeasureGroup>
    	</MeasureGroups>
    </Cube>
    
     <Cube name="PretrialServicesParticipation" caption="Pretrial Services Participation">
    	<Dimensions>
    		<Dimension source='YesNoIndicator' caption="Pre Charge Monitoring"/>
    		<Dimension source='Risk Score'/>
    		<Dimension source='Race'/>
    		<Dimension source='Sex'/>
    		<Dimension source='Age'/>
    		<Dimension source='County'/>
    		<Dimension source='Region'/>
    		<Dimension source='Date'/>
    	</Dimensions>
    	<MeasureGroups>
    		<MeasureGroup table="PretrialServicesParticipation">
	    		<Measures>
					<Measure name="PretrialServiceParticipantCount" column="PretrialServiceParticipationID" datatype="Integer" aggregator="distinct-count" caption="Pretrial Service Participant Count" visible="true"/>
	    		</Measures>
	    		 <DimensionLinks>
                    <ForeignKeyLink dimension='YesNoIndicator' foreignKeyColumn='PreChargeMonitoringIndicator'/>
                    <ForeignKeyLink dimension='Risk Score' foreignKeyColumn='RiskScoreID'/>
                    <ForeignKeyLink dimension='Race' foreignKeyColumn="ArresteeRaceID"/>
                    <ForeignKeyLink dimension='Sex' foreignKeyColumn="ArresteeSexID"/>
                    <ForeignKeyLink dimension='Age' foreignKeyColumn="ArresteeAgeID"/>
                    <ForeignKeyLink dimension='County' foreignKeyColumn="CountyID"/>
                    <ForeignKeyLink dimension='Region' foreignKeyColumn='RegionID'/>
                    <ForeignKeyLink dimension='Date' foreignKeyColumn='IntakeDateID'/>
	             </DimensionLinks>
          </MeasureGroup>
    	</MeasureGroups>
    </Cube>
    
     <Cube name="PretrialServicesNeedsAssessment" caption="Pretrial Services Needs Assesment">
    	<Dimensions>
    		<Dimension source='Risk Score'/>
    		<Dimension source="Assessed Need"/>
    		<Dimension source='Race'/>
    		<Dimension source='Sex'/>
    		<Dimension source='Age'/>
    		<Dimension source='County'/>
    		<Dimension source='Region'/>
    		<Dimension source='Date'/>
    	</Dimensions>
    	<MeasureGroups>
    		<MeasureGroup table="PretrialServicesNeedsAssessment">
	    		<Measures>
					<Measure name="PretrialServiceParticipantCount" column="PretrialServiceParticipationID" datatype="Integer" aggregator="distinct-count" caption="Pretrial Service Participant Count" visible="true"/>
	    		</Measures>
	    		 <DimensionLinks>
                    <ForeignKeyLink dimension='Risk Score' foreignKeyColumn='RiskScoreID'/>
                    <ForeignKeyLink dimension='Assessed Need' foreignKeyColumn='AssessedNeedID'/>
                    <ForeignKeyLink dimension='Race' foreignKeyColumn="ArresteeRaceID"/>
                    <ForeignKeyLink dimension='Sex' foreignKeyColumn="ArresteeSexID"/>
                    <ForeignKeyLink dimension='Age' foreignKeyColumn="ArresteeAgeID"/>
                    <ForeignKeyLink dimension='County' foreignKeyColumn="CountyID"/>
                    <ForeignKeyLink dimension='Region' foreignKeyColumn='RegionID'/>
                    <ForeignKeyLink dimension='Date' foreignKeyColumn='IntakeDateID'/>
	             </DimensionLinks>
          </MeasureGroup>
    	</MeasureGroups>
    </Cube>
    
    <Cube name="PretrialServicesUtilized" caption="Pretrial Services Utilized">
    	<Dimensions>
    		<Dimension source='Risk Score'/>
    		<Dimension source="Pretrial Service"/>
    		<Dimension source='Race'/>
    		<Dimension source='Sex'/>
    		<Dimension source='Age'/>
    		<Dimension source='County'/>
    		<Dimension source='Region'/>
    		<Dimension source='Date'/>
    	</Dimensions>
    	<MeasureGroups>
    		<MeasureGroup table="PretrialServicesUtilized">
	    		<Measures>
					<Measure name="PretrialServiceParticipantCount" column="PretrialServiceParticipationID" datatype="Integer" aggregator="distinct-count" caption="Pretrial Service Participant Count" visible="true"/>
	    		</Measures>
	    		 <DimensionLinks>
                    <ForeignKeyLink dimension='Risk Score' foreignKeyColumn='RiskScoreID'/>
                    <ForeignKeyLink dimension='Pretrial Service' foreignKeyColumn='PretrialServiceID'/>
                    <ForeignKeyLink dimension='Race' foreignKeyColumn="ArresteeRaceID"/>
                    <ForeignKeyLink dimension='Sex' foreignKeyColumn="ArresteeSexID"/>
                    <ForeignKeyLink dimension='Age' foreignKeyColumn="ArresteeAgeID"/>
                    <ForeignKeyLink dimension='County' foreignKeyColumn="CountyID"/>
                    <ForeignKeyLink dimension='Region' foreignKeyColumn='RegionID'/>
                    <ForeignKeyLink dimension='Date' foreignKeyColumn='IntakeDateID'/>
	             </DimensionLinks>
          </MeasureGroup>
    	</MeasureGroups>
    </Cube>
    

    
    <Cube name="CrimeRate" caption="Crime Rate" visible="true">
    	<Dimensions>
    		<Dimension source="Year"/>
    		<Dimension source="County"/>
    		<Dimension source="Race"/>
    		<Dimension source="Sex"/>
    		<Dimension source="Age Range"/>
    		<!-- TODO: figure out why ignoreUnrelatedDimensions doesn't work -->
<!--     		<Dimension source="Drug"/> -->
<!--     		<Dimension source="Offense Type"/> -->
    	</Dimensions>
    	 <MeasureGroups>
            <MeasureGroup table='Population' ignoreUnrelatedDimensions="true">
                <Measures>
                    <Measure name='PopulationCount' column='PopulationCount' aggregator='sum' datatype="Integer" caption="Population Count"/>
                </Measures>
                <DimensionLinks>
                    <ForeignKeyLink dimension='County' foreignKeyColumn='CountyID'/>
                    <ForeignKeyLink dimension='Year' foreignKeyColumn='Year'/>
                    <ForeignKeyLink dimension='Race' foreignKeyColumn='PersonRaceID'/>
                    <ForeignKeyLink dimension='Sex' foreignKeyColumn='PersonSexID'/>
                    <ForeignKeyLink dimension='Age Range' foreignKeyColumn='PersonAgeRangeID'/>
                </DimensionLinks>
            </MeasureGroup>
            <MeasureGroup table="CrimeCount" ignoreUnrelatedDimensions="true">
    			<Measures>
    				<Measure name="ArrestCount" column="ArrestCount" datatype="Integer" aggregator="sum" caption="Arrest Count" visible="true"/>
    			</Measures>
    			<DimensionLinks>
                    <ForeignKeyLink dimension="Year" foreignKeyColumn="Year"/>
                     <ForeignKeyLink dimension="County" foreignKeyColumn="CountyID"/>
                     <ForeignKeyLink dimension="Race" foreignKeyColumn="ArresteeRaceID"/>
                     <ForeignKeyLink dimension="Sex" foreignKeyColumn="ArresteeSexID"/>
                     <ForeignKeyLink dimension="Age Range" foreignKeyColumn="PersonAgeRangeID"/>
<!--                      <ForeignKeyLink dimension="Drug" foreignKeyColumn="InvolvedDrugID"/> -->
<!--                      <ForeignKeyLink dimension="Offense Type" foreignKeyColumn="ArrestOffenseTypeID"/> -->
                </DimensionLinks>
    		</MeasureGroup>
        </MeasureGroups>
        <CalculatedMembers>
        	<CalculatedMember name="Crime Rate Per 1000" dimension="Measures">
				<Formula>(1000 * ValidMeasure([Measures].[ArrestCount])) / ValidMeasure([Measures].[PopulationCount])</Formula>
				<CalculatedMemberProperty name="FORMAT_STRING" value="#0.00"/>
			</CalculatedMember>
        </CalculatedMembers>
    </Cube>
    
</Schema>

